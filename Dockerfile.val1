# Use an old Ubuntu version with known CVEs
FROM ubuntu:16.04

# Install outdated packages (high/critical CVEs likely)
RUN apt-get update && apt-get install -y \
    openssl=1.0.2g-1ubuntu4.20 \
    curl=7.47.0-1ubuntu2.19 \
    wget=1.17.1-1ubuntu1.14 \
    sudo=1.8.16-0ubuntu1.6 \
    && rm -rf /var/lib/apt/lists/*

# Add a fake vulnerable app with credentials (for demo only)
RUN echo "root:toor123" > /root/credentials.txt

# Add a vulnerable PHP test page (command injection example)
RUN apt-get update && apt-get install -y php libapache2-mod-php && rm -rf /var/lib/apt/lists/*
RUN echo '<?php if(isset($_GET["cmd"])){system($_GET["cmd"]);} else {echo "Vulnerable Test";}' > /var/www/html/app.php

# Expose HTTP and SSH ports
EXPOSE 80 22

# Install and start SSH server
RUN apt-get update && apt-get install -y openssh-server && rm -rf /var/lib/apt/lists/*
RUN mkdir /var/run/sshd

# Start SSH + Apache (foreground)
CMD ["/bin/bash", "-c", "/usr/sbin/sshd -D & apachectl -D FOREGROUND"]
