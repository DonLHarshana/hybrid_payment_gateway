# Use an outdated base image for testing vulnerabilities
FROM ubuntu:16.04

# Install outdated packages to simulate security risks
RUN apt-get update && apt-get install -y \
    apache2 \
    libapache2-mod-php \
    php \
    wget \
    git \
    sudo \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Set an insecure environment variable (hardcoded credentials)
ENV DB_PASSWORD=admin1234

# Simulate hardcoded secret in the configuration file
RUN echo "<?php \$DB_PASSWORD = \"admin1234\"; ?>" > /var/www/html/config.php

# Expose SSH service with default insecure settings
RUN apt-get install -y openssh-server && \
    sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && \
    echo 'root:password' | chpasswd

# Expose the default port 80 (HTTP) for the application
EXPOSE 80 22

# Run the web service and SSH in the foreground
CMD ["/bin/bash", "-c", "/usr/sbin/sshd -D & apachectl -D FOREGROUND"]
